package core.basesyntax.service;

import static org.junit.Assert.assertThrows;
import static org.junit.jupiter.api.Assertions.assertEquals;

import core.basesyntax.db.StockDao;
import core.basesyntax.db.StockDaoStorageImpl;
import core.basesyntax.storage.Storage;
import org.junit.jupiter.api.Test;

class InventoryFromCsvTest {
    private final StockDao stockDao = new StockDaoStorageImpl();

    @Test
    void synchronizeWithTheStorage_fileDoNotExists_NotOk() {
        final String notExistingFile = "notExistingFile.csv";
        Inventory inventory = new InventoryFromCsv(stockDao, notExistingFile);
        assertThrows(RuntimeException.class,
                () -> inventory.synchronizeWithTheStorage());
    }

    @Test
    void synchronizeWithTheStorage_emptyFile_Ok() {
        final String emptyFile = "emptyFile.csv";
        Inventory inventory = new InventoryFromCsv(stockDao, emptyFile);
    }

    @Test
    void synchronizeWithTheStorage_addingProductData_Ok() {
        final String addingProduct = "addingProduct.csv";
        Inventory inventory = new InventoryFromCsv(stockDao, addingProduct);
        inventory.synchronizeWithTheStorage();
        String product = "banana";
        Integer amount = 20;
        assertEquals(amount, Storage.stock.get(product));
    }

    @Test
    void synchronizeWithTheStorage_supply_Ok() {
        final String supply = "supply.csv";
        Inventory inventorySupply = new InventoryFromCsv(stockDao, supply);
        inventorySupply.synchronizeWithTheStorage();
        String product = "banana";
        Integer amount = 120;
        assertEquals(amount, Storage.stock.get(product));
    }

    @Test
    void synchronizeWithTheStorage_return_Ok() {
        final String purchase = "return.csv";
        Inventory inventoryPurchase = new InventoryFromCsv(stockDao, purchase);
        inventoryPurchase.synchronizeWithTheStorage();
        String product = "banana";
        Integer amount = 40;
        assertEquals(amount, Storage.stock.get(product));
    }

    @Test
    void synchronizeWithTheStorage_purchase_Ok() {
        final String purchase = "purchase.csv";
        Inventory inventoryPurchase = new InventoryFromCsv(stockDao, purchase);
        inventoryPurchase.synchronizeWithTheStorage();
        String product = "banana";
        Integer amount = 10;
        assertEquals(amount, Storage.stock.get(product));
    }

    @Test
    void synchronizeWithTheStorage_incorrectData_TooManyComma_NotOk() {
        final String tooManyComma = "tooManyComma.csv";
        Inventory inventory = new InventoryFromCsv(stockDao, tooManyComma);
        assertThrows(InvalidDataException.class,
                () -> inventory.synchronizeWithTheStorage());
    }

    @Test
    void synchronizeWithTheStorage_incorrectData_AmountIsNotANumber_NotOk() {
        final String amountIsNotANumber = "amountIsNotANumber.csv";
        Inventory inventory = new InventoryFromCsv(stockDao, amountIsNotANumber);
        assertThrows(InvalidDataException.class,
                () -> inventory.synchronizeWithTheStorage());
    }

    @Test
    void synchronizeWithTheStorage_incorrectData_NotExistingOperation_NotOk() {
        final String notExistingOperation = "notExistingOperation.csv";
        Inventory inventory = new InventoryFromCsv(stockDao, notExistingOperation);
        assertThrows(InvalidDataException.class,
                () -> inventory.synchronizeWithTheStorage());
    }

    @Test
    void synchronizeWithTheStorage_unacceptableOperation_decreaseBelowZero_NotOk() {
        final String decreaseBelowZero = "decreaseBelowZero.csv";
        Inventory inventoryDecreaseBelowZero = new InventoryFromCsv(stockDao, decreaseBelowZero);
        assertThrows(UnacceptableStockOperationException.class,
                () -> inventoryDecreaseBelowZero.synchronizeWithTheStorage());
    }

    @Test
    void synchronizeWithTheStorage_unacceptableOperation_increaseBelowZero_NotOk() {
        final String increaseBelowZero = "increaseBelowZero.csv";
        Inventory inventoryIncreaseBelowZero = new InventoryFromCsv(stockDao, increaseBelowZero);
        assertThrows(UnacceptableStockOperationException.class,
                () -> inventoryIncreaseBelowZero.synchronizeWithTheStorage());
    }

    @Test
    void synchronizeWithTheStorage_unacceptableOperation_noSuchElement_NotOk() {
        final String noSuchElement = "noSuchElement.csv";
        Inventory inventoryNoSuchElement = new InventoryFromCsv(stockDao, noSuchElement);
        assertThrows(UnacceptableStockOperationException.class,
                () -> inventoryNoSuchElement.synchronizeWithTheStorage());
    }
}
